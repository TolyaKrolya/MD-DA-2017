---
title: "Lab 3"
author: "Teslenko RI-440005"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Лабораторная работа 3
## Задачи для лабораторной: 
* работа с текстом;
* использование регулярных выражений для извлечения данных;
* переписывание существующего кода;
* ассиметричные распределения.

## Исходные данные
Файл forbes.htm содержит список богатейших американцев по версии журнала Форбс. На его примере потренируемся в разборе html страниц.

### Задание 1
1. Используйте команду readLines для загрузки файла в текстовый вектор html. a) Сколько строк в файле? b) Сколько символов в файле?

```{r}
html <- readLines("https://raw.githubusercontent.com/SergeyMirvoda/MD-DA-2017/master/data/forbes.htm");
length(html);
sum(nchar(html));
```

*Количество строк в файле 1991, количество символов в файле: 80380*

2. Откройте файл в текстовом редакторе. Найдите строки, содержащие данные о Билле Гейтсе и Ларри Эллисоне, и запомните размер их дохода.

*Билл Гейтс: 72$ Ларри Эллисон: 41$*

3. Напишите шаблон регулярного выражения и используйте функцию grep, чтобы извлечь размер дохода из данных в векторе html. Удостоверьтесь, что полученный вектор номеров строк содержит содержит ровно 100 записей и ссылается на номера строк в которых действительно есть информация о доходе, а не просто первый попавшийся текст.

```{r}
worth.num<-grep("\\$[0-9,]+ B",html);
print("Длина вектора:")
length(worth.num) #длина вектора
print("Строки, содержащие сведения о доходе:")
html[worth.num] #вывод строк, соответствующих номерам, содержащимся в векторе
```

4. Напишите код, использовав регулярное выражение из п. 3, и функции regexpr и regmatches, чтобы извлечь все данные о доходе. Проверьте следующее: a. Должно быть ровно сто значений. b. Самый большой доход должен быть доход Билла Гейтса c. Такой доход должен быть в списке один раз. d. В списке должна быть цифра, которую мы запомнили для Ларри Эллисона. e. Должно быть как минимум два значения, встречающихся несколько раз.

```{r}
worth.position<-regexpr("\\$[0-9,]+ B",html); #нахождение позиции данных о доходе в строках
worth.value<-regmatches(html,worth.position); #создание вектора доходов

length(worth.value); #ровно 100 значений
worth.value[1]; #самый большой доход Билла Гейтса
length(worth.value[worth.value=="$72 B"]); #доход, как у Билла Гейтса, встречается только раз
worth.value[worth.value=="$41 B"] #вывод значения дохода Ларри Эллисона
length(unique(worth.value)); #после удаления повторяющихся элементов осталось 66 элементов из 100
```

5. В данных доход представлен в формате "$42 B", что означает 42 × 10^9. Преобразуйте этот формат в числовой и сохраните в вектор worths. Удостоверьтесь в следующем: a. worths является вектором и в нём сто занчений типа double. b. Все элементы вектора worths больше 1 миллиарда. c. Самое большое число это доход Билла Гейтса.

```{r}
worth.num.position<-regexpr("[0-9,]+",worth.value);
worths<-regmatches(worth.value,worth.num.position);
worths<-gsub(",",".",worths);
worths<-as.double(worths)*10^9;

is.vector(worths); #worths является вектором
length(worths[worths>10^9]); #все 100 значений больше одного миллиарда
max(worths); #самое большое число - 7.2*10^10 - доход Билла Гейтса
```

6. Используйте вектор worths , чтобы выяснить следующее: a. Какова медиана ста этих записей? b. Средний доход? c. Как много людей из этого списка имеют доход больше 5млрд., 10, 25? d. Какой их общий доход? e. Какую долю от общего дохода, составляет пятёрка самых богатых. f. Какую долю от общего дохода, составляют 20 самых богатых. g. В данных федерального резерва США найдите показатель дохода всех домохозяйств (Household net worth) в соответвующем году, какую долю общего дохода составляют 100 богатейших людей.

```{r}
median(worths); #медиана: 8.3*10^9
mean(worths); #средний доход: 1.293*10^10
length(worths[worths>5*10^9]); #89 людей имеют доход свыше 5 млрд.
length(worths[worths>10*10^9]); #39 людей имеют доход свыше 10 млрд.
length(worths[worths>25*10^9]); #12 людей имеют доход свыше 25 млрд.
sum(worths[1:5])/sum(worths); #для пятерки самых богатых доля от общего дохода 0.1883217
sum(worths[1:20])/sum(worths); #для двадцати самых богатых доля от общего дохода 0.4921114
household.net.worth<-78536*10^9; #доход всех домохозяйств за 2013 год
sum(worths)/household.net.worth; #доля 100 богатейших людей от общего дохода всех домохозяйств: 0.01646379
```